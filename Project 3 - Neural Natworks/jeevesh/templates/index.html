<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stock Prediction Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stock-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }
        
        .prediction-up {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .prediction-down {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .header h1 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .prediction-result {
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .prediction-up {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: #2d5016;
        }
        
        .prediction-down {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
        }
        
        .model-metrics {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            min-width: 120px;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }
        
        .metric-label {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .feature-input {
            margin-bottom: 10px;
        }
        
        .feature-input label {
            font-weight: 500;
            color: #495057;
        }
        
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner-border {
            color: #667eea;
        }
        
        .chart-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            border-radius: 10px 10px 0 0;
            border: none;
            color: #6c757d;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-white mb-4">
                    <i class="fas fa-brain text-purple-400 mr-4"></i>
                    <span class="gradient-text">AI Stock Predictor</span>
                </h1>
                <p class="text-xl text-gray-300">Advanced Neural Networks for Market Intelligence</p>
                <div class="flex justify-center mt-6">
                    <div class="glass-card px-6 py-3">
                        <span class="text-green-400 font-semibold">ðŸŸ¢ Live Models Active</span>
                        <span class="text-gray-400 mx-2">â€¢</span>
                        <span class="text-blue-400 font-semibold">âš¡ Real-time Predictions</span>
                    </div>
                </div>
            </div>

            <!-- Stock Selection Section -->
            <div class="glass-card p-8 mb-8">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                    <i class="fas fa-search text-blue-400 mr-3"></i>
                    Select Stock for Analysis
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- Popular Stocks -->
                    <div class="stock-card glass-card p-4 text-center" onclick="selectStock('AAPL', 'Apple Inc.')">
                        <i class="fab fa-apple text-3xl text-gray-300 mb-2"></i>
                        <h3 class="text-white font-semibold">AAPL</h3>
                        <p class="text-gray-400 text-sm">Apple Inc.</p>
                    </div>
                    
                    <div class="stock-card glass-card p-4 text-center" onclick="selectStock('GOOGL', 'Alphabet Inc.')">
                        <i class="fab fa-google text-3xl text-gray-300 mb-2"></i>
                        <h3 class="text-white font-semibold">GOOGL</h3>
                        <p class="text-gray-400 text-sm">Alphabet Inc.</p>
                    </div>
                    
                    <div class="stock-card glass-card p-4 text-center" onclick="selectStock('TSLA', 'Tesla Inc.')">
                        <i class="fas fa-car text-3xl text-gray-300 mb-2"></i>
                        <h3 class="text-white font-semibold">TSLA</h3>
                        <p class="text-gray-400 text-sm">Tesla Inc.</p>
                    </div>
                    
                    <div class="stock-card glass-card p-4 text-center" onclick="selectStock('MSFT', 'Microsoft Corp.')">
                        <i class="fab fa-microsoft text-3xl text-gray-300 mb-2"></i>
                        <h3 class="text-white font-semibold">MSFT</h3>
                        <p class="text-gray-400 text-sm">Microsoft Corp.</p>
                    </div>
                </div>
                
                <div class="flex flex-col md:flex-row gap-4 items-center">
                    <div class="flex-1">
                        <input type="text" id="customStock" placeholder="Enter custom stock symbol (e.g., NVDA)" 
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-400">
                    </div>
                    <button onclick="selectCustomStock()" 
                            class="px-6 py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-blue-600 transition-all">
                        <i class="fas fa-plus mr-2"></i>Add Stock
                    </button>
                </div>
                
                <div id="selectedStock" class="mt-6 hidden">
                    <div class="glass-card p-4 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-400 mr-3"></i>
                            <span class="text-white font-semibold">Selected: </span>
                            <span id="selectedStockName" class="text-blue-400 ml-2"></span>
                        </div>
                        <button onclick="generateStockData()" 
                                class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all">
                            <i class="fas fa-chart-line mr-2"></i>Generate Data
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="flex flex-wrap gap-2 mb-8">
                <button class="tab-btn active px-6 py-3 glass-card text-white font-semibold rounded-lg" onclick="showTab('prediction')">
                    <i class="fas fa-brain mr-2"></i>Prediction
                </button>
                <button class="tab-btn px-6 py-3 glass-card text-white font-semibold rounded-lg" onclick="showTab('comparison')">
                    <i class="fas fa-chart-bar mr-2"></i>Model Comparison
                </button>
                <button class="tab-btn px-6 py-3 glass-card text-white font-semibold rounded-lg" onclick="showTab('features')">
                    <i class="fas fa-cogs mr-2"></i>Feature Analysis
                </button>
                <button class="tab-btn px-6 py-3 glass-card text-white font-semibold rounded-lg" onclick="showTab('simulation')">
                    <i class="fas fa-chart-area mr-2"></i>Stock Simulation
                </button>
            </div>

            <!-- Tab Content -->
            <div id="tabContent">
                <!-- Prediction Tab -->
                <div id="prediction" class="tab-content active">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Input Panel -->
                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                                <i class="fas fa-sliders-h text-blue-400 mr-3"></i>
                                Model Configuration
                            </h3>
                            
                            <!-- Model Selection -->
                            <div class="mb-6">
                                <label class="block text-gray-300 font-semibold mb-2">Select AI Model:</label>
                                <select id="modelSelect" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-purple-400">
                                    <option value="enhanced_neural_network">ðŸ§  Enhanced Neural Network</option>
                                    <option value="ensemble_model">ðŸŽ¯ Ensemble Model</option>
                                    <option value="advanced_features">âš¡ Advanced Features Model</option>
                                    <option value="neural_network">ðŸ”¹ Standard Neural Network</option>
                                    <option value="manual_logistic">ðŸ“Š Manual Logistic Regression</option>
                                    <option value="sklearn_logistic">ðŸ”§ Sklearn Logistic Regression</option>
                                </select>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <button onclick="generateSampleData()" class="px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all">
                                    <i class="fas fa-random mr-2"></i>Sample Data
                                </button>
                                <button onclick="optimizeFeatures()" class="px-4 py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition-all">
                                    <i class="fas fa-magic mr-2"></i>Auto-Optimize
                                </button>
                            </div>
                            
                            <!-- Prediction Button (Moved to top) -->
                            <button onclick="makePrediction()" class="w-full px-6 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg font-bold text-lg hover:from-purple-700 hover:to-pink-700 transition-all transform hover:scale-105 mb-6">
                                <i class="fas fa-brain mr-3"></i>Predict Stock Movement
                            </button>
                            
                            <!-- Feature Inputs -->
                            <div id="featureInputs" class="space-y-3 mb-6">
                                <!-- Feature inputs will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Results Panel -->
                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                                <i class="fas fa-crystal-ball text-purple-400 mr-3"></i>
                                AI Prediction Results
                            </h3>
                            
                            <!-- Model Performance Metrics -->
                            <div id="modelMetrics" class="mb-6">
                                <!-- Model metrics will be loaded here -->
                            </div>
                            
                            <!-- Loading State -->
                            <div id="loadingState" class="hidden text-center py-8">
                                <div class="animate-pulse-slow">
                                    <i class="fas fa-brain text-4xl text-purple-400 mb-4"></i>
                                    <p class="text-white font-semibold">AI is analyzing market patterns...</p>
                                    <div class="mt-4">
                                        <div class="w-full bg-gray-700 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full animate-pulse" style="width: 70%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Prediction Result -->
                            <div id="predictionResult">
                                <div class="glass-card p-6 text-center">
                                    <i class="fas fa-info-circle text-3xl text-blue-400 mb-4"></i>
                                    <p class="text-gray-300">Configure your model and features above, then click predict to see AI-powered market analysis.</p>
                                </div>
                            </div>
                            
                            <!-- Confidence Meter -->
                            <div id="confidenceMeter" class="hidden mt-6">
                                <h4 class="text-white font-semibold mb-3">Prediction Confidence</h4>
                                <div class="w-full bg-gray-700 rounded-full h-4">
                                    <div id="confidenceBar" class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>
                                <div class="flex justify-between text-sm text-gray-400 mt-2">
                                    <span>Low</span>
                                    <span>Medium</span>
                                    <span>High</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Comparison Tab -->
                <div id="comparison" class="tab-content hidden">
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-balance-scale text-green-400 mr-3"></i>
                            Model Performance Comparison
                        </h3>
                        <div id="comparisonChart" class="bg-white/5 rounded-lg p-4">
                            <div class="text-center py-8">
                                <i class="fas fa-chart-bar text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-300">Loading model comparison...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feature Analysis Tab -->
                <div id="features" class="tab-content hidden">
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-microscope text-yellow-400 mr-3"></i>
                            Feature Importance Analysis
                        </h3>
                        <div id="featureChart" class="bg-white/5 rounded-lg p-4 mb-6">
                            <div class="text-center py-8">
                                <i class="fas fa-cogs text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-300">Loading feature analysis...</p>
                            </div>
                        </div>
                        <div id="featureList"></div>
                    </div>
                </div>

                <!-- Stock Simulation Tab -->
                <div id="simulation" class="tab-content hidden">
                    <div class="glass-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <i class="fas fa-chart-line text-red-400 mr-3"></i>
                            Stock Price Simulation
                        </h3>
                        <div class="mb-6">
                            <button onclick="loadStockSimulation()" class="px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg font-semibold hover:from-red-600 hover:to-pink-600 transition-all">
                                <i class="fas fa-refresh mr-2"></i>Generate New Simulation
                            </button>
                        </div>
                        <div id="simulationChart" class="bg-white/5 rounded-lg p-4 mb-6">
                            <div class="text-center py-8">
                                <i class="fas fa-chart-area text-4xl text-gray-400 mb-4"></i>
                                <p class="text-gray-300">Click above to generate stock simulation...</p>
                            </div>
                        </div>
                        <div id="simulationStats"></div>
                    </div>
                </div>
            </div>
    </div>

    <script>
        // Global variables
        let featureNames = [];
        let modelMetrics = {};
        let selectedStockSymbol = '';
        let selectedStockName = '';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadModelInfo();
            generateSampleData();
            showTab('prediction');
        });
        
        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-gradient-to-r', 'from-purple-500', 'to-blue-500');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button
            event.target.classList.add('active', 'bg-gradient-to-r', 'from-purple-500', 'to-blue-500');
            
            // Load tab-specific content
            if (tabName === 'comparison') {
                setTimeout(loadModelComparison, 100);
            } else if (tabName === 'features') {
                setTimeout(loadFeatureImportance, 100);
            } else if (tabName === 'simulation') {
                setTimeout(() => {
                    if (!document.querySelector('#simulationChart img')) {
                        loadStockSimulation();
                    }
                }, 100);
            }
        }
        
        // Stock Selection Functions
        function selectStock(symbol, name) {
            selectedStockSymbol = symbol;
            selectedStockName = `${symbol} - ${name}`;
            
            // Update UI
            document.getElementById('selectedStockName').textContent = selectedStockName;
            document.getElementById('selectedStock').classList.remove('hidden');
            
            // Visual feedback
            document.querySelectorAll('.stock-card').forEach(card => {
                card.classList.remove('ring-2', 'ring-purple-400');
            });
            event.currentTarget.classList.add('ring-2', 'ring-purple-400');
        }
        
        function selectCustomStock() {
            const customInput = document.getElementById('customStock');
            const symbol = customInput.value.trim().toUpperCase();
            
            if (symbol) {
                selectStock(symbol, 'Custom Stock');
                customInput.value = '';
            } else {
                alert('Please enter a valid stock symbol');
            }
        }
        
        function generateStockData() {
            if (!selectedStockSymbol) {
                alert('Please select a stock first');
                return;
            }
            
            // Show loading state
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Generating...';
            button.disabled = true;
            
            // Simulate data generation (in real app, this would call an API)
            setTimeout(() => {
                generateSampleData();
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Show success message
                showNotification(`Generated data for ${selectedStockSymbol}`, 'success');
            }, 2000);
        }
        
        function optimizeFeatures() {
            showNotification('Auto-optimizing features for better accuracy...', 'info');
            
            // Simulate optimization
            setTimeout(() => {
                // Randomly adjust feature values for demo
                const inputs = document.querySelectorAll('#featureInputs input');
                inputs.forEach(input => {
                    const currentValue = parseFloat(input.value);
                    const optimizedValue = currentValue * (0.9 + Math.random() * 0.2); // Â±10% adjustment
                    input.value = optimizedValue.toFixed(6);
                });
                
                showNotification('Features optimized for maximum accuracy!', 'success');
            }, 1500);
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'from-green-500 to-emerald-500',
                error: 'from-red-500 to-rose-500',
                info: 'from-blue-500 to-indigo-500'
            };
            
            notification.className = `fixed top-4 right-4 px-6 py-3 bg-gradient-to-r ${colors[type]} text-white rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} mr-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Load model information
        async function loadModelInfo() {
            try {
                const response = await fetch('/api/models/info');
                const data = await response.json();
                modelMetrics = data;
                updateModelMetrics();
            } catch (error) {
                console.error('Error loading model info:', error);
            }
        }

        // Update model metrics display
        function updateModelMetrics() {
            const selectedModel = document.getElementById('modelSelect').value;
            const metrics = modelMetrics[selectedModel] || modelMetrics['neural_network'] || {accuracy: 0.588, roc_auc: 0.565};
            
            const modelNames = {
                'enhanced_neural_network': 'ðŸ§  Enhanced Neural Network',
                'ensemble_model': 'ðŸŽ¯ Ensemble Model', 
                'advanced_features': 'âš¡ Advanced Features Model',
                'neural_network': 'ðŸ”¹ Standard Neural Network',
                'manual_logistic': 'ðŸ“Š Manual Logistic Regression',
                'sklearn_logistic': 'ðŸ”§ Sklearn Logistic Regression'
            };
            
            document.getElementById('modelMetrics').innerHTML = `
                <div class="glass-card p-4 mb-4">
                    <h4 class="text-white font-semibold mb-3">${modelNames[selectedModel] || 'Selected Model'}</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-400">${(metrics.accuracy * 100).toFixed(1)}%</div>
                            <div class="text-gray-400 text-sm">Accuracy</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-400">${metrics.roc_auc.toFixed(3)}</div>
                            <div class="text-gray-400 text-sm">ROC-AUC</div>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <span class="inline-block px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">
                            ${metrics.accuracy > 0.55 ? 'âœ… High Performance' : metrics.accuracy > 0.52 ? 'âš¡ Good Performance' : 'ðŸ”„ Training Mode'}
                        </span>
                    </div>
                </div>
            `;
        }

        // Generate sample data
        async function generateSampleData() {
            try {
                const response = await fetch('/api/generate_sample');
                const data = await response.json();
                
                featureNames = data.feature_names;
                createFeatureInputs(data.feature_dict);
            } catch (error) {
                console.error('Error generating sample data:', error);
            }
        }

        // Create feature input fields
        function createFeatureInputs(featureDict) {
            const container = document.getElementById('featureInputs');
            container.innerHTML = '';
            
            // Group features by type for better organization
            const featureGroups = {
                'Returns': [],
                'Moving Averages': [],
                'Technical': [],
                'Other': []
            };
            
            Object.entries(featureDict).forEach(([name, value]) => {
                if (name.includes('Returns_lag')) {
                    featureGroups['Returns'].push([name, value]);
                } else if (name.includes('SMA')) {
                    featureGroups['Moving Averages'].push([name, value]);
                } else if (['RSI', 'MACD', 'Volatility'].some(tech => name.includes(tech))) {
                    featureGroups['Technical'].push([name, value]);
                } else {
                    featureGroups['Other'].push([name, value]);
                }
            });
            
            Object.entries(featureGroups).forEach(([groupName, features]) => {
                if (features.length > 0) {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'mb-4';
                    groupDiv.innerHTML = `
                        <h5 class="text-gray-300 font-semibold mb-2 text-sm">${groupName}</h5>
                        <div class="space-y-2">
                            ${features.map(([name, value]) => `
                                <div class="flex items-center space-x-3">
                                    <label class="text-gray-400 text-sm w-32 truncate" title="${name}">${name.replace('_', ' ')}:</label>
                                    <input type="number" id="feature_${name}" 
                                           value="${value.toFixed(6)}" step="0.000001"
                                           class="flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded text-white text-sm focus:outline-none focus:border-purple-400">
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(groupDiv);
                }
            });
        }

        // Make prediction
        async function makePrediction() {
            const loadingDiv = document.getElementById('loadingState');
            const resultDiv = document.getElementById('predictionResult');
            const confidenceDiv = document.getElementById('confidenceMeter');
            
            // Show loading
            loadingDiv.classList.remove('hidden');
            resultDiv.innerHTML = '';
            confidenceDiv.classList.add('hidden');
            
            try {
                // Collect feature values
                const features = [];
                featureNames.forEach(name => {
                    const input = document.getElementById(`feature_${name}`);
                    if (input) {
                        features.push(parseFloat(input.value));
                    }
                });
                
                const modelName = document.getElementById('modelSelect').value;
                
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: modelName,
                        features: features,
                        stock_symbol: selectedStockSymbol
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const isUp = data.prediction === 1;
                    const confidence = (data.confidence * 100).toFixed(1);
                    const probability = (data.probability * 100).toFixed(1);
                    
                    // Show prediction result
                    resultDiv.innerHTML = `
                        <div class="${isUp ? 'prediction-up' : 'prediction-down'} p-6 rounded-lg text-white text-center">
                            <div class="text-4xl mb-4">
                                <i class="fas fa-arrow-${isUp ? 'up' : 'down'}"></i>
                            </div>
                            <h4 class="text-xl font-bold mb-2">${selectedStockSymbol || 'Stock'} Prediction</h4>
                            <p class="text-lg mb-2">Direction: <strong>${data.direction.toUpperCase()}</strong></p>
                            <p class="text-sm opacity-90">Probability: ${probability}%</p>
                            <div class="mt-4 text-xs opacity-75">
                                Model: ${document.getElementById('modelSelect').selectedOptions[0].text}
                            </div>
                        </div>
                    `;
                    
                    // Show confidence meter
                    confidenceDiv.classList.remove('hidden');
                    const confidenceBar = document.getElementById('confidenceBar');
                    setTimeout(() => {
                        confidenceBar.style.width = `${confidence}%`;
                    }, 500);
                    
                } else {
                    resultDiv.innerHTML = `
                        <div class="glass-card p-6 text-center">
                            <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                            <p class="text-red-400">${data.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="glass-card p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Error making prediction: ${error.message}</p>
                    </div>
                `;
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        // Load model comparison chart
        async function loadModelComparison() {
            const chartDiv = document.getElementById('comparisonChart');
            
            chartDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="animate-pulse-slow">
                        <i class="fas fa-chart-bar text-4xl text-purple-400 mb-4"></i>
                        <p class="text-white font-semibold">Loading model comparison...</p>
                    </div>
                </div>
            `;
            
            try {
                const response = await fetch('/api/model_comparison');
                const data = await response.json();
                
                if (response.ok && data.success) {
                    chartDiv.innerHTML = `<img src="data:image/png;base64,${data.plot}" alt="Model Comparison" class="w-full rounded-lg">`;
                } else {
                    chartDiv.innerHTML = `
                        <div class="glass-card p-6 text-center">
                            <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                            <p class="text-red-400">${data.error || 'Failed to load comparison chart'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                chartDiv.innerHTML = `
                    <div class="glass-card p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Error loading chart: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Load feature importance chart
        async function loadFeatureImportance() {
            const chartDiv = document.getElementById('featureChart');
            const listDiv = document.getElementById('featureList');
            
            chartDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="animate-pulse-slow">
                        <i class="fas fa-cogs text-4xl text-yellow-400 mb-4"></i>
                        <p class="text-white font-semibold">Analyzing feature importance...</p>
                    </div>
                </div>
            `;
            listDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/feature_importance');
                const data = await response.json();
                
                if (response.ok && data.success) {
                    chartDiv.innerHTML = `<img src="data:image/png;base64,${data.plot}" alt="Feature Importance" class="w-full rounded-lg">`;
                    
                    // Display feature list
                    const featuresHtml = data.features.map((feature, index) => 
                        `<div class="flex justify-between items-center p-3 ${index % 2 === 0 ? 'bg-white/5' : 'bg-white/10'} rounded">
                            <span class="text-white font-semibold">${feature.feature}</span>
                            <span class="px-3 py-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-full text-sm font-bold">
                                ${feature.importance.toFixed(4)}
                            </span>
                        </div>`
                    ).join('');
                    
                    listDiv.innerHTML = `
                        <div class="glass-card p-4">
                            <h4 class="text-white font-bold mb-4 flex items-center">
                                <i class="fas fa-trophy text-yellow-400 mr-2"></i>
                                Top Features by Importance
                            </h4>
                            <div class="space-y-2">${featuresHtml}</div>
                        </div>
                    `;
                } else {
                    chartDiv.innerHTML = `
                        <div class="glass-card p-6 text-center">
                            <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                            <p class="text-red-400">${data.error || 'Failed to load feature importance'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                chartDiv.innerHTML = `
                    <div class="glass-card p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Error loading chart: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Load stock simulation
        async function loadStockSimulation() {
            const chartDiv = document.getElementById('simulationChart');
            const statsDiv = document.getElementById('simulationStats');
            
            chartDiv.innerHTML = `
                <div class="text-center py-8">
                    <div class="animate-pulse-slow">
                        <i class="fas fa-chart-area text-4xl text-red-400 mb-4"></i>
                        <p class="text-white font-semibold">Generating stock simulation...</p>
                    </div>
                </div>
            `;
            statsDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/stock_simulation');
                const data = await response.json();
                
                if (response.ok && data.success) {
                    chartDiv.innerHTML = `<img src="data:image/png;base64,${data.plot}" alt="Stock Simulation" class="w-full rounded-lg">`;
                    
                    const stats = data.stats;
                    statsDiv.innerHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-green-400">$${stats.start_price}</div>
                                <div class="text-gray-400 text-sm">Start Price</div>
                            </div>
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-blue-400">$${stats.end_price}</div>
                                <div class="text-gray-400 text-sm">End Price</div>
                            </div>
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold ${parseFloat(stats.total_return) >= 0 ? 'text-green-400' : 'text-red-400'}">
                                    ${stats.total_return}%
                                </div>
                                <div class="text-gray-400 text-sm">Total Return</div>
                            </div>
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-purple-400">${stats.volatility}%</div>
                                <div class="text-gray-400 text-sm">Volatility</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-yellow-400">$${stats.max_price}</div>
                                <div class="text-gray-400 text-sm">Max Price</div>
                            </div>
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-orange-400">$${stats.min_price}</div>
                                <div class="text-gray-400 text-sm">Min Price</div>
                            </div>
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-red-400">${stats.max_drawdown}%</div>
                                <div class="text-gray-400 text-sm">Max Drawdown</div>
                            </div>
                            <div class="glass-card p-4 text-center">
                                <div class="text-2xl font-bold text-indigo-400">${stats.sharpe_ratio}</div>
                                <div class="text-gray-400 text-sm">Sharpe Ratio</div>
                            </div>
                        </div>
                    `;
                } else {
                    chartDiv.innerHTML = `
                        <div class="glass-card p-6 text-center">
                            <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                            <p class="text-red-400">${data.error || 'Failed to generate simulation'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                chartDiv.innerHTML = `
                    <div class="glass-card p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-3xl text-red-400 mb-4"></i>
                        <p class="text-red-400">Error loading simulation: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Tab change event handlers
        document.getElementById('comparison-tab').addEventListener('click', function() {
            setTimeout(loadModelComparison, 100);
        });

        document.getElementById('features-tab').addEventListener('click', function() {
            setTimeout(loadFeatureImportance, 100);
        });

        document.getElementById('simulation-tab').addEventListener('click', function() {
            setTimeout(loadStockSimulation, 100);
        });

        // Model selection change handler
        document.getElementById('modelSelect').addEventListener('change', updateModelMetrics);
    </script>
</body>
</html>
